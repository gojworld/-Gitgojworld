<%@ page language="java" contentType="text/html; charset=utf-8" pageEncoding="utf-8"%>
<%@ include file="/WEB-INF/includes/taglibs.jsp"%>
<script type="text/javascript">

	$(document).ready(function(){
		// 조회영역의 학기를 변경시 강의교과목 select box list 구현(ajax 처리) //start
	    $("#cslmSearch #semCd").change(function() {
	        var $ls = $("#lecSubj");
	        var url     = "univ/cusl/cslm/findLecSubjList.do";
	        var params  = {
	             "yy":$("#yy").val()
	            ,"semCd":$("#semCd").val()
	        };

	        $ls.find("option").remove();
	        $ls.trigger("chosen:updated");
	        $ls.append($("<option>", {value: "", text: "선택"}));

	        $.ajax({
	            type:"post",
	            url:url,
	            async:false,
	            dataType:"json",
	            data:params,
	            success: function( json ) {
	                $.each(json.lecSubjList, function(i, value) {
	                   $ls.append($('<option>')
	                              .text(json.lecSubjList[i].subjNm)
	                                  .attr('value', json.lecSubjList[i].selKey)
	                                      .data("values"
	                                              ,{
	                                                   pYy      : json.lecSubjList[i].pYy
	                                                  ,pSemCd   : json.lecSubjList[i].pSemCd
	                                                  ,pOpOrgid : json.lecSubjList[i].pOpOrgid
	                                                  ,pSubjId  : json.lecSubjList[i].pSubjId
	                                                  ,pDvclsNb : json.lecSubjList[i].pDvclsNb
	                                                  ,tabIndex : 2
	                                               }
	                          ));
	                });
	                $ls.trigger("chosen:updated");
	            }
	        });
	    });
	    // 조회영역의 학기를 변경시 강의교과목 select box list 구현(ajax 처리) //end
		//년도의 입력필드를 벗어나면, 강의교과목 정보를 가져온다.
		$("#cslmSearch #yy").on('focusout', function(e) {
		    $lecSubjAjax();
		});
		// 강의교과목 정보를 가져온다.
	    var $lecSubjAjax = function $lecSubjAjax() {

	        var $ls = $("#lecSubj");
	        var url     = "univ/cusl/cslm/findLecSubjList.do";
	        var params  = {
	             "yy":$("#yy").val()
	            ,"semCd":$("#semCd").val()
	        };

	        $ls.find("option").remove();
	        $ls.trigger("chosen:updated");

	        $.ajax({
	            type:"post",
	            url:url,
	            async:false,
	            dataType:"json",
	            data:params,
	            success: function(json) {
	                $.each(json.lecSubjList, function(i, value) {
	                   $ls.append($('<option>')
	                              .text(json.lecSubjList[i].subjNm)
	                                  .attr('value', json.lecSubjList[i].selKey)
	                                      .data("values",{
	                                                           pYy      : json.lecSubjList[i].pYy
	                                                          ,pSemCd   : json.lecSubjList[i].pSemCd
	                                                          ,pOpOrgid : json.lecSubjList[i].pOpOrgid
	                                                          ,pSubjId  : json.lecSubjList[i].pSubjId
	                                                          ,pDvclsNb : json.lecSubjList[i].pDvclsNb
	                                                          ,tabIndex : 2
	                                                     }));
	                });

	                $ls.trigger("chosen:updated");
	            }
	        });
	    };
		$("#cslmSearch").validate({
	        rules: {

	        },
	        messages: {

	        },
	        submitHandler: function(form) {
	            if($( ".tabs" ).find("li").index($( ".tabs" ).find("li").filter("[aria-selected='true']")) == 2) {
	                 var selected = $("#cslmSearch #lecSubj").find('option:selected');
	                 var $dataTag = selected.data('values');

	                 $("#cslmSearch").find("[name$=pYy]").val($dataTag.pYy);
	                 $("#cslmSearch").find("[name$=pSemCd]").val($dataTag.pSemCd);
	                 $("#cslmSearch").find("[name$=pOpOrgid]").val($dataTag.pOpOrgid);
	                 $("#cslmSearch").find("[name$=pSubjId]").val($dataTag.pSubjId);
	                 $("#cslmSearch").find("[name$=pDvclsNb]").val($dataTag.pDvclsNb);
	                 $("#cslmSearch").find("[name$=selKey]").val($("#lecSubj option:selected").val());
	            }
	            form.action = location.href;
	            form.submit();
	        }
	    });
	});
</script>
<c:if test="${requestScope['javax.servlet.forward.query_string'] != null}">
	<c:set var="questionMark" value="?" />
</c:if>
<form:form modelAttribute="cslmSearch" method="post" class="form-inline" data-role="search" data-message="alert">
	<input type="hidden" id="tabIndex" name="tabIndex" value="">
	<input type="hidden" id="pDvclsNb" name="pDvclsNb" value="">
	<input type="hidden" id="pSubjId" name="pSubjId" value="">
	<input type="hidden" id="pOpOrgid" name="pOpOrgid" value="">
	<input type="hidden" id="pYy" name="pYy" value="">
	<input type="hidden" id="pSemCd" name="pSemCd" value="">
	<input type="hidden" id="selKey" name="selKey" value="">
	<div class="search_wrap">
		<ul>
			<li>
				<div class="f_l w_49 mr_5">
					<span class="form_select">
						<form:select path="yy" class="chosen-select" data-placeholder="년도">
							<form:options items="${basInfo.yyList}" />
						</form:select>
					</span>
				</div>
				<div>
					<span class="form_select">
						<form:select path="semCd" class="chosen-select" data-placeholder="학기">
							<form:option value="">학기</form:option>
							<form:options items="${semCdList}" itemValue="cmnCdval" itemLabel="cmnCdvalNm" />
						</form:select>
					</span>
				</div>
			</li>
			<li class="tab3">
				<span class="form_select">
					<form:select path="lecSubj">
						<c:forEach var="list" items="${lecSubjList}" varStatus="loop">
							<form:option value="${list.selKey}" data-values='{ "pYy": "${list.pYy}", "pSemCd": "${list.pSemCd}" , "pOpOrgid": "${list.pOpOrgid}" , "pSubjId": "${list.pSubjId}" , "tabIndex": 2 , "pDvclsNb": "${list.pDvclsNb}"}'>${list.subjNm}</form:option>
						</c:forEach>
					</form:select>
				</span>
			</li>
			<li>
				<button class="btn gray02">SEARCH</button>
			</li>
		</ul>
	</div>
</form:form>
<div class="tabs tabs_type03 cusl_wrap">
	<ul class="slice03 line_blue">
		<li>
			<a href="#tabs1" onclick="location.href='${requestScope['javax.servlet.forward.request_uri']}${questionMark}${requestScope['javax.servlet.forward.query_string']}#tabs1';" class="tabOne">상담예약학생</a>
		</li>
		<li>
			<a href="#tabs2" onclick="location.href='${requestScope['javax.servlet.forward.request_uri']}${questionMark}${requestScope['javax.servlet.forward.query_string']}#tabs2';" class="tabTwo">상담지도학생</a>
		</li>
		<li>
			<a href="#tabs3" onclick="location.href='${requestScope['javax.servlet.forward.request_uri']}${questionMark}${requestScope['javax.servlet.forward.query_string']}#tabs3';" class="tabThree">수강학생</a>
		</li>
	</ul>
	<div id="tabs1">
		<div class="group">
			<div class="tit_group">
				<h3>학생리스트</h3>
				<strong class="num_result">
					[검색결과
					<span>${fn:length(cuslResvList)}</span>
					건]
				</strong>
			</div>
			<c:choose>
				<c:when test="${!empty cuslResvList}">
					<c:forEach var="cuslResv" items="${cuslResvList}" varStatus="loop">
						<div class="tbl_line tbl_round">
							<div class="tbl_dsp">
								<div class="cell_mid w_40">
									<strong class="fs_13 fc_org">[학번 ${cuslResv.stuid} ]</strong>
									<br />
									<strong class="fs_18 fw_bb">${cuslResv.nm}</strong>
								</div>
								<ul class="list_line reset">
									<li>
										<span>소속</span>
										<em>${cuslResv.pstnOrgzNm}</em>
									</li>
									<li>
										<span>현재학기상담횟수</span>
										<em>${cuslResv.curSemCuslCnt}</em>
									</li>
									<li>
										<span>공학인증</span>
										<em>${cuslResv.abeekYn}</em>
									</li>
									<li>
										<span>휴대폰 번호</span>
										<em class="fs_13 fc_blue">${cuslResv.mpTelno}</em>
									</li>
								</ul>
							</div>
							<div class="btn_wrap">
								<a href="univ/cusl/cslm/views/findCuslHisList.do?stuid=${cuslResv.stuid}" class="btn white f_l w_49 cuslhis" data-params='{"stuid": "${cuslCoach.stuid}","nm":"${cuslCoach.nm}","pstnOrgzNm":"${cuslCoach.pstnOrgzNm}"}'>상담이력</a>
								<a href="univ/cusl/cslm/views/findCounslInptForm.do?stuid=${cuslResv.stuid}&yy=${cslmSearch.yy}&semCd=${cslmSearch.semCd}&tabIndex=1&callPageGbn=cuslInput&pTabIndex=1&selKey=${selKeyVal}&pSubjId=${selPsubjId}&pOpOrgid=${selPopOrgid}&pDvclsNb=${selPdvclsNb}" data-method="post" class="btn blue">상담입력</a>
							</div>
						</div>
					</c:forEach>
				</c:when>
				<c:otherwise>
					<div class="box_empty">
						<p class="tit">조회된 데이터가 없습니다.</p>
					</div>
				</c:otherwise>
			</c:choose>
		</div>
	</div>
	<div id="tabs2">
		<div class="group">
			<div class="tit_group">
				<h3>학생리스트</h3>
				<strong class="num_result">
					[검색결과
					<span>${fn:length(cuslCoachList)}</span>
					건]
				</strong>
			</div>
			<c:choose>
				<c:when test="${!empty cuslCoachList}">
					<c:forEach var="cuslCoach" items="${cuslCoachList}" varStatus="loop">
						<div class="tbl_line tbl_round">
							<div class="tbl_dsp">
								<div class="cell_mid w_40">
									<strong class="fs_13 fc_org">[학번 ${cuslCoach.stuid}]</strong>
									<br />
									<strong class="fs_18 fw_bb">${cuslCoach.nm}</strong>
								</div>
								<ul class="list_line reset">
									<li>
										<span>소속</span>
										<em>${cuslCoach.pstnOrgzNm}</em>
									</li>
									<li>
										<span>현재학기상담횟수</span>
										<em>${cuslCoach.curSemCuslCnt}</em>
									</li>
									<li>
										<span>공학인증</span>
										<em>${cuslCoach.abeekYn}</em>
									</li>
									<li>
										<span>휴대폰 번호</span>
										<em class="fs_13 fc_blue">${cuslCoach.mpTelno}</em>
									</li>
								</ul>
							</div>
							<div class="btn_wrap">
								<a href="univ/cusl/cslm/views/findCuslHisList.do?stuid=${cuslCoach.stuid}" class="btn white f_l w_49 cuslhis" data-params='{"stuid": "${cuslCoach.stuid}","nm":"${cuslCoach.nm}","pstnOrgzNm":"${cuslCoach.pstnOrgzNm}"}'>상담이력</a>
								<a href="univ/cusl/cslm/views/findCounslInptForm.do?stuid=${cuslCoach.stuid}&yy=${cslmSearch.yy}&semCd=${cslmSearch.semCd}&tabIndex=1&callPageGbn=cuslInput&pTabIndex=1&selKey=${selKeyVal}&pSubjId=${selPsubjId}&pOpOrgid=${selPopOrgid}&pDvclsNb=${selPdvclsNb}" data-method="post" class="btn blue">상담입력</a>
							</div>
						</div>
					</c:forEach>
				</c:when>
				<c:otherwise>
					<div class="box_empty">
						<p class="tit">조회된 데이터가 없습니다.</p>
					</div>
				</c:otherwise>
			</c:choose>
		</div>
	</div>
	<div id="tabs3">
		<div class="group">
			<div class="tit_group">
				<h3>학생리스트</h3>
				<strong class="num_result">
					[검색결과
					<span>${fn:length(cuslTlsnList)}</span>
					건]
				</strong>
			</div>
			<c:choose>
				<c:when test="${!empty cuslTlsnList}">
					<c:forEach var="cuslTlsn" items="${cuslTlsnList}" varStatus="loop">
						<div class="tbl_line tbl_round">
							<div class="tbl_dsp">
								<div class="cell_mid w_40">
									<strong class="fs_13 fc_org">[학번 ${cuslTlsn.stuid}]</strong>
									<br />
									<strong class="fs_18 fw_bb">${cuslTlsn.nm}</strong>
								</div>
								<ul class="list_line reset">
									<li>
										<span>소속</span>
										<em>${cuslTlsn.pstnOrgzNm}</em>
									</li>
									<li>
										<span>현재학기상담횟수</span>
										<em>${cuslTlsn.curSemCuslCnt}</em>
									</li>
									<li>
										<span>공학인증</span>
										<em>${cuslTlsn.abeekYn}</em>
									</li>
									<li>
										<span>휴대폰 번호</span>
										<em class="fs_13 fc_blue">${cuslTlsn.mpTelno}</em>
									</li>
								</ul>
							</div>
							<div class="btn_wrap">
								<a href="univ/cusl/cslm/views/findCuslHisList.do?stuid=${cuslTlsn.stuid}" class="btn white f_l w_49 cuslhis" data-params='{"stuid": "${cuslCoach.stuid}","nm":"${cuslCoach.nm}","pstnOrgzNm":"${cuslCoach.pstnOrgzNm}"}'>상담이력</a>
								<a href="univ/cusl/cslm/views/findCounslInptForm.do?stuid=${cuslTlsn.stuid}&yy=${cslmSearch.yy}&semCd=${cslmSearch.semCd}&tabIndex=1&callPageGbn=cuslInput&pTabIndex=2&selKey=${selKeyVal}&pSubjId=${selPsubjId}&pOpOrgid=${selPopOrgid}&pDvclsNb=${selPdvclsNb}" data-method="post" class="btn blue">상담입력</a>
							</div>
						</div>
					</c:forEach>
				</c:when>
				<c:otherwise>
					<div class="box_empty">
						<p class="tit">조회된 데이터가 없습니다.</p>
					</div>
				</c:otherwise>
			</c:choose>
		</div>
	</div>
</div>
<div id="cusl_his_template" style="display: none;">
	<div class="cusl_wrap">
		<div class="tbl_line">
			<div class="tbl_dsp line_bot">
				<div class="cell_mid w_90_px ta_c p_reset">
					<!-- <img src="../css/images/sample/std_pic.jpg" alt="프로필사진" /> -->
				</div>
				<ul class="list_line">
					<li>
						<span>성명</span>
						<em class="fw_bb">{nm}</em>
					</li>
					<li>
						<span>학번</span>
						<em>{stuid}</em>
					</li>
					<li>
						<span>소속</span>
						<em>{pstnOrgzNm}</em>
					</li>
				</ul>
			</div>
			<div class="tbl_dsp">
				<div class="cell_mid w_70_px ta_c">
					<strong class="fc_org fw_bb">[재학중]</strong>
				</div>
				<ul class="list_line">
					<li>
						<span>학년/학기</span>
						<em>2015년도 1학기</em>
					</li>
				</ul>
			</div>
		</div>
		<div class="group">
			<div class="tit_group">
				<h3>상담이력</h3>
				<strong class="num_result">
					[검색결과
					<span>6</span>
					건]
				</strong>
			</div>
			<div id="appendHis" class="acc tbl_line tbl_row tbl_round">
				<table>
					<caption>년도, 학기에 따른 상담일자와 상담내용</caption>
					<colgroup>
						<col style="width: 25%" />
						<col />
						<col style="width: 20%" />
						<col />
					</colgroup>
					<tbody>
						<tr>
							<th scope="row">년도/학기</th>
							<td colspan="3">
								<strong class="fs_13">2015년도 1학기</strong>
							</td>
						</tr>
						<tr>
							<th scope="row">상담일자</th>
							<td colspan="3">2015. 06. 04</td>
						</tr>
						<tr>
							<th scope="row">채용직종</th>
							<td>직접면담</td>
							<th scope="row">근무지역</th>
							<td>교수연구실</td>
						</tr>
						<tr class="tbl_cont">
							<th scope="row">상담내용</th>
							<td colspan="3">졸업 후 해외 현장에서 일하고 싶음.학점은 3.6정도 토익 910점 정도스피킹 시험 필요중국어와 스페인어 공부 중</td>
						</tr>
						<tr>
							<th scope="row">결과 및 참고</th>
							<td colspan="3"></td>
						</tr>
					</tbody>
				</table>
				<div class="acc_cont tbl_col">
					<table>
						<caption>구분에 따른 비고와 선택</caption>
						<colgroup>
							<col style="width: 15%" />
							<col style="width: 20%" />
							<col />
						</colgroup>
						<thead>
							<tr>
								<th scope="col">선택</th>
								<th scope="col">구분</th>
								<th scope="col">비고</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td class="ta_c">
									<span class="form_chck">
										<input type="checkbox" id="aa" />
										<label for="aa" class="hide">선택</label>
									</span>
								</td>
								<td>대인관계</td>
								<td>친구, 선후배, 교수</td>
							</tr>
							<tr>
								<td class="ta_c">
									<span class="form_chck">
										<input type="checkbox" id="aa" />
										<label for="aa" class="hide">선택</label>
									</span>
								</td>
								<td>학교생활</td>
								<td>수업, 교직, 학과적응, 대학생문화</td>
							</tr>
							<tr>
								<td class="ta_c">
									<span class="form_chck">
										<input type="checkbox" id="aa" />
										<label for="aa" class="hide">선택</label>
									</span>
								</td>
								<td>가정</td>
								<td>부모, 형제/자매, 가정폭력</td>
							</tr>
							<tr>
								<td class="ta_c">
									<span class="form_chck">
										<input type="checkbox" id="aa" />
										<label for="aa" class="hide">선택</label>
									</span>
								</td>
								<td>취업진로</td>
								<td>적성/흥미, 정보탐색, 자기소개</td>
							</tr>
							<tr>
								<td class="ta_c">
									<span class="form_chck">
										<input type="checkbox" id="aa" />
										<label for="aa" class="hide">선택</label>
									</span>
								</td>
								<td>성</td>
								<td>이성관계, 성희롱, 성폭력</td>
							</tr>
							<tr>
								<td class="ta_c">
									<span class="form_chck">
										<input type="checkbox" id="aa" />
										<label for="aa" class="hide">선택</label>
									</span>
								</td>
								<td>경제</td>
								<td>대출, 등록금, 아르바이트, 유흥비</td>
							</tr>
							<tr>
								<td class="ta_c">
									<span class="form_chck">
										<input type="checkbox" id="aa" />
										<label for="aa" class="hide">선택</label>
									</span>
								</td>
								<td>건강</td>
								<td>신체, 정신, 장애등급</td>
							</tr>
							<tr>
								<td class="ta_c">
									<span class="form_chck">
										<input type="checkbox" id="aa" />
										<label for="aa" class="hide">선택</label>
									</span>
								</td>
								<td>멘토링</td>
								<td></td>
							</tr>
						</tbody>
					</table>
				</div>
				<div class="acc_btn">
					<span>상담분류</span>
				</div>
			</div>
		</div>
	</div>
</div>
<div id="aa" style="display: none">
	<table>
		<caption>년도, 학기에 따른 상담일자와 상담내용</caption>
		<colgroup>
			<col style="width: 25%" />
			<col />
			<col style="width: 20%" />
			<col />
		</colgroup>
		<tbody>
			<tr>
				<th scope="row">년도/학기</th>
				<td colspan="3">
					<strong class="fs_13">2015년도 1학기</strong>
				</td>
			</tr>
			<tr>
				<th scope="row">상담일자</th>
				<td colspan="3">2015. 06. 04</td>
			</tr>
			<tr>
				<th scope="row">채용직종</th>
				<td>직접면담</td>
				<th scope="row">근무지역</th>
				<td>교수연구실</td>
			</tr>
			<tr class="tbl_cont">
				<th scope="row">상담내용</th>
				<td colspan="3">졸업 후 해외 현장에서 일하고 싶음.학점은 3.6정도 토익 910점 정도스피킹 시험 필요중국어와 스페인어 공부 중</td>
			</tr>
			<tr>
				<th scope="row">결과 및 참고</th>
				<td colspan="3"></td>
			</tr>
		</tbody>
	</table>
	<div class="acc_cont tbl_col">
		<table>
			<caption>구분에 따른 비고와 선택</caption>
			<colgroup>
				<col style="width: 15%" />
				<col style="width: 20%" />
				<col />
			</colgroup>
			<thead>
				<tr>
					<th scope="col">선택</th>
					<th scope="col">구분</th>
					<th scope="col">비고</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td class="ta_c">
						<span class="form_chck">
							<input type="checkbox" id="aa" />
							<label for="aa" class="hide">선택</label>
						</span>
					</td>
					<td>대인관계</td>
					<td>친구, 선후배, 교수</td>
				</tr>
				<tr>
					<td class="ta_c">
						<span class="form_chck">
							<input type="checkbox" id="aa" />
							<label for="aa" class="hide">선택</label>
						</span>
					</td>
					<td>학교생활</td>
					<td>수업, 교직, 학과적응, 대학생문화</td>
				</tr>
				<tr>
					<td class="ta_c">
						<span class="form_chck">
							<input type="checkbox" id="aa" />
							<label for="aa" class="hide">선택</label>
						</span>
					</td>
					<td>가정</td>
					<td>부모, 형제/자매, 가정폭력</td>
				</tr>
				<tr>
					<td class="ta_c">
						<span class="form_chck">
							<input type="checkbox" id="aa" />
							<label for="aa" class="hide">선택</label>
						</span>
					</td>
					<td>취업진로</td>
					<td>적성/흥미, 정보탐색, 자기소개</td>
				</tr>
				<tr>
					<td class="ta_c">
						<span class="form_chck">
							<input type="checkbox" id="aa" />
							<label for="aa" class="hide">선택</label>
						</span>
					</td>
					<td>성</td>
					<td>이성관계, 성희롱, 성폭력</td>
				</tr>
				<tr>
					<td class="ta_c">
						<span class="form_chck">
							<input type="checkbox" id="aa" />
							<label for="aa" class="hide">선택</label>
						</span>
					</td>
					<td>경제</td>
					<td>대출, 등록금, 아르바이트, 유흥비</td>
				</tr>
				<tr>
					<td class="ta_c">
						<span class="form_chck">
							<input type="checkbox" id="aa" />
							<label for="aa" class="hide">선택</label>
						</span>
					</td>
					<td>건강</td>
					<td>신체, 정신, 장애등급</td>
				</tr>
				<tr>
					<td class="ta_c">
						<span class="form_chck">
							<input type="checkbox" id="aa" />
							<label for="aa" class="hide">선택</label>
						</span>
					</td>
					<td>멘토링</td>
					<td></td>
				</tr>
			</tbody>
		</table>
	</div>
	<div class="acc_btn">
		<span>상담분류</span>
	</div>
</div>