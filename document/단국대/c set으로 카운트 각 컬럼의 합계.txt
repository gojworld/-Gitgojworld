<%@ page language="java" contentType="text/html; charset=utf-8" pageEncoding="utf-8"%>
<%@ include file="/WEB-INF/includes/taglibs.jsp"%>
<script type="text/javascript">
	var errorMessage="${errorMessage}";
	if(errorMessage!=""){
		alert(errorMessage);
	}
	$(document).ready(function(){
		console.log($("#aplCnt").val())
		$(".aplCntValInput").html($("#aplCnt").val());
		$(".aplSumCrdValInput").html($("#aplSumCrd").val());
		$(".wdCntValInput").html($("#wdCnt").val());
		$(".wdSumCrdValInput").html($("#wdSumCrd").val());
		var possibleTerm="${possibleTerm}";
		if(possibleTerm!='Y'){}
		// table내에 있는 a click이벤트
		$(".tkcrsWdTbl a").click(function(e){
			e.preventDefault();
			if($(this).parents("li").find("[name$=tkcrsWdPsblYn]").val()==0){
				alert("수강철회 불가 상태입니다.\n해당부서에 문의하세요.");
				return null;
			}
			var param={
				"tkcrsStaCd":$(this).find("[name$=tkcrsStaCd]").val(),
				"opOrgid":$(this).parents("li").find("[name$=opOrgid]").val(),
				"yy":$(this).parents("li").find("[name$=yy]").val(),
				"semCd":$(this).parents("li").find("[name$=semCd]").val(),
				"subjId":$(this).parents("li").find("[name$=subjId]").val(),
				"subjNm":$(this).parents("li").find("[name$=subjNm]").val(),
				"dvclsNb":$(this).parents("li").find("[name$=dvclsNb]").val(),
				"webAplDelPsblYn":$(this).parents("li").find("[name$=webAplDelPsblYn]").val(),
				"tkcrsWdPsblYn":$(this).parents("li").find("[name$=tkcrsWdPsblYn]").val(),
				"sznDtlWokId":$(this).parents("li").find("[name$=sznDtlWokId]").val(),
				"cprmSchgr":$(this).parents("li").find("[name$=cprmSchgr]").val(),
				"scregStaCd":$(this).parents("li").find("[name$=scregStaCd]").val(),
				"minCrd":$(this).parents("li").find("[name$=minAlCrd]").val(),
				"tkcrsFeAmt":$(this).parents("li").find("[name$=tkcrsFeAmt]").val(),
				"loginUserDiv":"1",
				"lockYn":"1",
				"stuid":"${tcamSearch.loginUserIntgUid}"
			};
			$.submit("univ/lssn/tcam/saveTkcrsWd.do",param);
		});
		$("#tkcrsWdClose").click(function(e){
			if(!confirm("마감후에는 기간내에라도 복원이 불가합니다.\n정말로 수강철회마감을 하시겠습니까?")){ return false; }
			var param={
				"yy":"${tkcrsWdMngtList[0].yy}",
				"semCd":"${tkcrsWdMngtList[0].semCd}",
				"tkcrsWdPsblYn":"0",
				"stuid":"${tcamSearch.loginUserIntgUid}"
			};
			$.submit("univ/lssn/tcam/saveTkcrsWdCancel.do",param);
			//alert("수강철회가 마감되었습니다.");
		});
	});
</script>
<div class="course_wrap">
	<div class="tbl_line tbl_row">
		<table>
			<caption>수강신청 과목수와 학점, 철회 과목수와 학점 안내</caption>
			<colgroup>
				<col style="width: 30%" />
				<col style="width: 20%" />
				<col style="width: 30%" />
				<col style="width: 20%" />
			</colgroup>
			<tbody>
				<c:set var="aplCnt" value="0" />
				<c:set var="aplSumCrd" value="0" />
				<c:set var="wdCnt" value="0" />
				<c:set var="wdSumCrd" value="0" />
				<tr>
					<th scope="row">수강신청 과목수</th>
					<td class="aplCntValInput">${aplCnt}</td>
					<th scope="row">수강신청 학점</th>
					<td class="aplSumCrdValInput">${aplSumCrd}</td>
				</tr>
				<tr>
					<th scope="row">수강철회 과목수</th>
					<td>${wdCnt}</td>
					<th scope="row">수강철회 신청 학점</th>
					<td class="wdSumCrdValInput">${wdSumCrd}</td>
				</tr>
			</tbody>
		</table>
	</div>
	<div class="group">
		<div class="tit_group">
			<h3>수강철회 관리</h3>
		</div>
		<ul class="reset03">
			<c:choose>
				<c:when test="${!empty tkcrsWdMngtList}">
					<c:forEach var="tkcrsWdMngt" items="${tkcrsWdMngtList}" varStatus="loop">
						<li class="tkcrsWdTbl">
							<input type="hidden" name="opOrgid" value="${tkcrsWdMngt.opOrgid}">
							<input type="hidden" name="yy" value="${tkcrsWdMngt.yy}">
							<input type="hidden" name="semCd" value="${tkcrsWdMngt.semCd}">
							<input type="hidden" name="subjId" value="${tkcrsWdMngt.subjId}">
							<input type="hidden" name="subjNm" value="${tkcrsWdMngt.subjKnm}">
							<input type="hidden" name="dvclsNb" value="${tkcrsWdMngt.dvclsNb}">
							<input type="hidden" name="webAplDelPsblYn" value="${tkcrsWdMngt.webAplDelPsblYn}">
							<input type="hidden" name="tkcrsWdPsblYn" value="${tkcrsWdMngt.tkcrsWdPsblYn}">
							<input type="hidden" name="sznDtlWokId" value="${tkcrsWdMngt.sznDtlWokId}">
							<input type="hidden" name="cprmSchgr" value="${tkcrsWdMngt.cprmSchgr}">
							<input type="hidden" name="scregStaCd" value="${tkcrsWdMngt.scregStaCd}">
							<input type="hidden" name="minAlCrd" value="${tkcrsWdMngt.minAlCrd}">
							<input type="hidden" name="tkcrsFeAmt" value="${tkcrsWdMngt.tkcrsFeAmt}">
							<div class="tbl_line tbl_round">
								<div class="cont">
									<span class="txt_over">
										<c:if test="${tkcrsWdMngt.tkcrsStaCd == '0009'}">
											<strong class="cdt blue">철회</strong>
										</c:if>
										<span class="fc_gray mr_5 va_m">[ ${tkcrsWdMngt.deptLoctNm} / ${tkcrsWdMngt.crd}학점 ]</span>
										<strong class="fs_16 va_m">${tkcrsWdMngt.subjKnm}</strong>
									</span>
								</div>
								<div class="tbl_dsp type_dash">
									<div class="cell_mid w_50">
										<em>교과목번호-분반</em><br />
										<strong class="fs_12">${tkcrsWdMngt.dvclsNb}</strong>
									</div>
									<div class="cell_mid">
										<em>교강사명</em><br />
										<strong class="fs_12">${tkcrsWdMngt.pfltNm}</strong>
									</div>
								</div>
								<ul class="list_dott top_line">
									<li>
										<strong>폐강</strong>
										<em>${tkcrsWdMngt.ltrTyNm}</em>
									</li>
									<li>
										<strong>수강정보</strong>
										<em><span class="txt_over">${tkcrsWdMngt.subjTtbl}</span></em>
									</li>
								</ul>
								<div class="btn_wrap">
									<c:if test="${tkcrsWdMngt.tkcrsStaCd == '0002'}">
										<c:set var="aplCnt" value="${aplCnt+1}" />
										<c:set var="aplSumCrd" value="${aplSumCrd+tkcrsWdMngt.crd}" />
										<a href="#" class="btn blue">
											철회신청
											<input type="hidden" name="tkcrsStaCd" value="0009">
										</a>
									</c:if>
									<c:if test="${tkcrsWdMngt.tkcrsStaCd == '0009'}">
										<c:set var="wdCnt" value="${wdCnt+1}" />
										<c:set var="wdSumCrd" value="${wdSumCrd+tkcrsWdMngt.crd}" />
										<a href="#" class="btn white">
											철회취소
											<input type="hidden" name="tkcrsStaCd" value="0002">
										</a>
									</c:if>
								</div>
							</div>
						</li>
					</c:forEach>
				</c:when>
				<c:otherwise>
					<div class="box_empty">
						<p class="tit">조회된 데이터가 없습니다.</p>
					</div>
				</c:otherwise>
			</c:choose>
			<input type="hidden" name="aplCnt" id="aplCnt" value="${aplCnt}" />
			<input type="hidden" name="aplSumCrd" id="aplSumCrd" value="${aplSumCrd}" />
			<input type="hidden" name="wdCnt" id="wdCnt" value="${wdCnt}" />
			<input type="hidden" name="wdSumCrd" id="wdSumCrd" value="${wdSumCrd}" />
		</ul>
	</div>
	<div class="group">
		<div class="tit_group">
			<h3 class="info">안내</h3>
		</div>
		<div class="box_info">
			<ul class="list_hyphen">
				<li>
					<span class="list_head">*</span>
					수강철회 확인서는 웹정보
					<strong>PC버전에서 출력</strong>
					해 주세요
				</li>
			</ul>
		</div>
	</div>
</div>
