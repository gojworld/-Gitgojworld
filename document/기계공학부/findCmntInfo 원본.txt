<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form"%>
<%@ taglib prefix="fn" uri="fnLibrary"%>
<script type="text/javascript">
	var _self={
		"init":function(){
			var listFun=function(e){
				if(e) e.preventDefault();
				$.submit({
					"method":"post",
					"action":"./findCmntList.do"
				});
			};
			$("#listBtn").click(listFun);
			$("#updateBtn").click(function(e){
				e.preventDefault();
				$.submit({
					"method":"post",
					"action":"./findCmntForm.do"
				},{
					"boardSeq":'${boardInfo.boardSeq}'
				});
			});
			$("#deleteBtn").click(function(e){
				e.preventDefault();
				$.fun.confirm({
					"content":"정말 삭제하시겠습니까?",
					"action":function(){
						$.ajax({
							"url":"/manage/cmnt/saveCmnt.do",
							"data":{
								"status":8,
								"boardSeq":'${boardInfo.boardSeq}'
							},
							"type":"post",
							"dataType":"json",
							"success":function(result){
								if(result.board.status!=1){
									$.fun.alert({
										"content":"삭제 되었습니다.",
										"action":listFun
									});
								}else{
									$.fun.alert({
										"content":"요청하신 작업이 실패되었습니다."
									});
								}
							}
						});
					}
				});
			});
			$(".memoSaveBtn").click(function(e){
				e.preventDefault();
				var $form=$("#memoInfo");
				$form.find("#status").val("2");
				$.ajax({
					"url":"/service/cmnt/saveMemo.do",
					"data":$form.serialize(),
					"type":"post",
					"dataType":"json",
					"success":function(result){
						if(result.memo.status!=-1){
							$.fun.alert({
								"content":result.memo.status==2?"등록되었습니다.":"수정되었습니다.",
								"action":function(){
									$.submit({
										"method":"post",
										"action":"./findCmntInfo.do"
									},{
										"boardSeq":'${boardInfo.boardSeq}'
									});
								}
							});
						}else{
							$.fun.alert({
								"content":"요청하신 작업이 실패되었습니다."
							});
						}
					}
				});
			});
			$(".memoDeleteBtn").click(function(e){
				e.preventDefault();
				var $div=$(this).parents("div").find(".coment_txt");
				var params=$div.params();
				$.extend(params,{
					status:8
				});
				$.fun.confirm({
					"content":"정말 삭제하시겠습니까?",
					"action":function(){
						$.ajax({
							"url":"/manage/cmnt/saveMemo.do",
							"data":params,
							"type":"post",
							"dataType":"json",
							"success":function(result){
								if(result.memo.status!=1){
									$.fun.alert({
										"content":"삭제 되었습니다.",
										"action":function(){
											location.reload();
										}
									});
								}else{
									$.fun.alert({
										"content":"요청하신 작업이 실패되었습니다."
									});
								}
							}
						});
						return true;
					}
				});
			});
			$(".memoUpdateBtn").click(function(e){
				$(".modifyTr").hide();
				$(this).parents("div").next().show();
				$(".modifyTr2").hide();
				e.preventDefault();
			});
			$(".memoUpdateBtn2").click(function(e){
				e.preventDefault();
				var $form=$(this).parents("div").find("#memoInfo1");
				$form.find("#status2").val("4");
				$.ajax({
					"url":"/service/cmnt/saveMemo.do",
					"data":$form.serialize(),
					"type":"post",
					"dataType":"json",
					"success":function(result){
						if(result.memo.status!=-1){
							$.fun.alert({
								"content":result.memo.status==2?"등록되었습니다.":"수정되었습니다.",
								"action":function(){
									$.submit({
										"method":"post",
										"action":"./findCmntInfo.do"
									},{
										"boardSeq":'${boardInfo.boardSeq}',
									});
								}
							});
						}else{
							$.fun.alert({
								"content":"요청하신 작업이 실패되었습니다."
							});
						}
					}
				});
			});
			$(".reUpdateBtn").click(function(e){
				$(".modifyTr2").hide();
				$(this).parents("div").next().next().show();
				$(".modifyTr").hide();
				e.preventDefault();
			});
			$(".reUpdateBtn2").click(function(e){
				e.preventDefault();
				var $form=$(this).parents("div").find("#memoInfo2");
				$form.find("#status3").val("2");
				$.ajax({
					"url":"/service/cmnt/saveMemo.do",
					"data":$form.serialize(),
					"type":"post",
					"dataType":"json",
					"success":function(result){
						if(result.memo.status!=-1){
							$.fun.alert({
								"content":result.memo.status==2?"등록되었습니다.":"수정되었습니다.",
								"action":function(){
									$.submit({
										"method":"post",
										"action":"./findCmntInfo.do"
									},{
										"boardSeq":'${boardInfo.boardSeq}',
									});
								}
							});
						}else{
							$.fun.alert({
								"content":"요청하신 작업이 실패되었습니다."
							});
						}
					}
				});
			});
			$(".prevBtn").click(function(e){
				e.preventDefault();
				$.submit({
					"method":"post",
					"action":"./findCmntInfo.do"
				},{
					"boardSeq":$(this).attr("id")
				});
			});
			$(".nextBtn").click(function(e){
				e.preventDefault();
				$.submit({
					"method":"post",
					"action":"./findCmntInfo.do"
				},{
					"boardSeq":$(this).attr("id")
				});
			});
		}
	};
	$(document).ready(function(){
		_self.init();
	});
</script>
<div class="talbe_view">
	<table>
		<colgroup>
			<col />
			<col style="width: 12%" />
			<col style="width: 15%" />
			<col style="width: 12%" />
		</colgroup>
		<thead>
			<tr>
				<th class="table_view_bg">${fn:nvl(boardInfo.ttl, '-')}</th>
				<th class="table_view_bg2 none">${fn:nvl(boardInfo.wrirNm, '-')}</th>
				<th class="table_view_bg2">${fn:dateFormat(boardInfo.inputDm,'yy.MM.dd')}</th>
				<th class="table_view_bg2">${fn:nvl(boardInfo.inqCnt, '-')}</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td colspan="4" class="view_m">
					<div class="HTML_CONTENT">${fn:nvl(boardInfo.cont,'-')}</div>
				</td>
			</tr>
			<tr>
				<td colspan="4" class="file_css">
					<span class="file_bg"></span>
					<c:choose>
						<c:when test="${!empty boardInfo.ulFile.ulFileLstList}">
							<c:forEach var="file" items="${boardInfo.ulFile.ulFileLstList}">
								<a href="/download.do?ufSeq=${file.ufSeq}&amp;fileSeq=${file.fileSeq}" target="_self">${file.origFileNm}</a>
							</c:forEach>
							</ul>
						</c:when>
						<c:otherwise>
							-
							</c:otherwise>
					</c:choose>
				</td>
			</tr>
		</tbody>
	</table>
</div>
<div class="talbe table2">
	<table>
		<colgroup>
			<col style="width: 13%" />
			<col style="width: 37%" />
			<col style="width: 37%" />
			<col style="width: 13%" />
		</colgroup>
		<tbody>
			<tr>
				<th>
					<c:if test="${boardInfo.boardSeq != boardInfo.minSeq}">
						<a href="#" class="prevBtn" id="${boardInfo.prevSeq}"><&nbsp;&nbsp;이전글</a>
					</c:if>
				</th>
				<td class="subj_l">${boardInfo.prevTtl}</td>
				<td class="subj_r">${boardInfo.nextTtl}</td>
				<th>
					<c:if test="${boardInfo.boardSeq != boardInfo.maxSeq}">
						<a href="#" class="nextBtn" id="${boardInfo.nextSeq}">다음글&nbsp;&nbsp;></a>
					</c:if>
				</th>
			</tr>
		</tbody>
	</table>
</div>
<c:choose>
	<c:when test="${menuCd eq 'ment' or menuCd eq 'free'}">
		<jsp:include page="inc/infoType1.jsp" />
	</c:when>
	<c:otherwise>
		<jsp:include page="inc/infoType2.jsp" />
	</c:otherwise>
</c:choose>
<c:choose>
	<c:when test="${menuCd eq 'ment' or menuCd eq 'free'}">
		<jsp:include page="inc/memo.jsp" />
	</c:when>
</c:choose>